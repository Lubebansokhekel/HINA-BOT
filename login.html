<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üîê BAN WHATSAPP - GALIRUS BOT</title>
<style>
    body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        overflow: hidden;
        position: relative;
    }

    /* Animasi latar belakang */
    body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(255, 0, 0, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(255, 0, 0, 0.1) 0%, transparent 50%);
        z-index: -1;
    }

    .container {
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        padding: 2rem 2.5rem;
        border-radius: 1.5rem;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
        width: 100%;
        max-width: 500px;
        text-align: center;
        border: 2px solid rgba(255, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }

    .container::before {
        content: "";
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background: linear-gradient(45deg, #ff0000, #ff3333, #ff6666, #ff9999, #ff6666, #ff3333, #ff0000);
        background-size: 400% 400%;
        z-index: -1;
        animation: gradientShift 3s ease infinite;
        border-radius: 1.8rem;
        opacity: 0.3;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .header {
        margin-bottom: 1.5rem;
        position: relative;
    }

    h1 {
        margin-bottom: 0.5rem;
        color: #ff3333;
        letter-spacing: 1px;
        font-size: 2rem;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    .subtitle {
        font-size: 1.2rem;
        color: #ff6666;
        margin-bottom: 0.5rem;
    }

    .tagline {
        font-size: 1rem;
        color: #ff9999;
        margin-bottom: 1rem;
        font-weight: bold;
    }

    .badge {
        display: inline-block;
        background: linear-gradient(45deg, #ff0000, #ff3333);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 1rem;
        font-size: 0.8rem;
        font-weight: bold;
        margin-bottom: 1rem;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    .features {
        display: flex;
        justify-content: space-around;
        margin: 1.5rem 0;
        flex-wrap: wrap;
    }

    .feature {
        background: rgba(255, 0, 0, 0.1);
        border: 1px solid rgba(255, 0, 0, 0.3);
        border-radius: 0.5rem;
        padding: 0.7rem;
        margin: 0.3rem;
        flex: 1;
        min-width: 120px;
        font-size: 0.8rem;
    }

    .feature i {
        display: block;
        font-size: 1.2rem;
        margin-bottom: 0.3rem;
    }

    input {
        width: 100%;
        padding: 0.8rem;
        border-radius: 0.5rem;
        border: 2px solid rgba(255, 0, 0, 0.3);
        outline: none;
        font-size: 1rem;
        margin: 1rem 0;
        text-align: center;
        box-sizing: border-box;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        transition: all 0.3s ease;
    }

    input:focus {
        border-color: #ff3333;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    button {
        width: 100%;
        padding: 0.8rem;
        border: none;
        border-radius: 0.5rem;
        background: linear-gradient(45deg, #ff0000, #ff3333);
        color: white;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }

    button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: 0.5s;
    }

    button:hover:not(:disabled) {
        transform: scale(1.03);
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }

    button:hover:not(:disabled)::before {
        left: 100%;
    }

    button:disabled {
        background: #555555;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .notif {
        margin-top: 1rem;
        padding: 0.8rem;
        border-radius: 0.5rem;
        display: none;
        font-weight: bold;
    }

    .notif.success {
        background: rgba(0, 255, 0, 0.1);
        color: #00ff00;
        border: 1px solid #00ff00;
    }

    .notif.error {
        background: rgba(255, 0, 0, 0.2);
        color: #ff8080;
        border: 1px solid #ff8080;
    }

    .notif.info {
        background: rgba(255, 255, 0, 0.1);
        color: #ffff00;
        border: 1px solid #ffff00;
    }

    .kode-container {
        margin-top: 1.5rem;
        padding: 1rem;
        background: rgba(255, 0, 0, 0.1);
        border-radius: 0.5rem;
        border: 2px solid #ff3333;
        display: none;
        position: relative;
        overflow: hidden;
    }

    .kode-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(255, 0, 0, 0.1), transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .kode-label {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        color: #ff3333;
    }

    .kode {
        font-size: 1.8rem;
        font-weight: bold;
        color: #fff;
        letter-spacing: 3px;
        font-family: monospace;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    .instruksi {
        margin-top: 1rem;
        font-size: 0.8rem;
        color: #ff9999;
        text-align: left;
        background: rgba(255, 0, 0, 0.1);
        padding: 0.8rem;
        border-radius: 0.5rem;
        display: none;
        border: 1px solid rgba(255, 0, 0, 0.3);
    }

    .status-bot {
        margin-top: 1rem;
        padding: 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        background: rgba(255, 0, 0, 0.1);
        border: 1px solid rgba(255, 0, 0, 0.3);
    }

    .status-connected {
        color: #00ff00;
    }

    .status-disconnected {
        color: #ff8080;
    }

    .port-info {
        margin-top: 0.5rem;
        font-size: 0.8rem;
        color: #ff3333;
        background: rgba(255, 0, 0, 0.1);
        padding: 0.5rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 0, 0, 0.3);
    }

    .port-error {
        color: #ff8080;
        background: rgba(255, 0, 0, 0.2);
    }

    .warning {
        background: rgba(255, 0, 0, 0.2);
        border: 1px solid rgba(255, 0, 0, 0.5);
        border-radius: 0.5rem;
        padding: 0.8rem;
        margin: 1rem 0;
        font-size: 0.8rem;
        color: #ff9999;
    }

    footer {
        margin-top: 2rem;
        font-size: 0.9rem;
        color: #ff9999;
    }

    footer span {
        color: #ff3333;
        font-weight: bold;
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üö´ BAN WHATSAPP</h1>
        <div class="subtitle">GALIRUS BOT ü§ñ</div>
        <div class="tagline">TAKUTKAN WHATSAPP ANDA DENGAN FITUR BAN!</div>
        <div class="badge">GRATIS 100% ‚Ä¢ TANPA BIAYA</div>
    </div>
    
    <div class="features">
        <div class="feature">
            <i>üö´</i>
            <div>BAN AKUN</div>
        </div>
        <div class="feature">
            <i>üîí</i>
            <div>BLOKIR GRUP</div>
        </div>
        <div class="feature">
            <i>‚ö°</i>
            <div>INSTANT</div>
        </div>
        <div class="feature">
            <i>üõ°Ô∏è</i>
            <div>AMAN</div>
        </div>
    </div>
    
    <div class="warning">
        ‚ö†Ô∏è <strong>PERINGATAN:</strong> Dengan menghubungkan WhatsApp Anda ke server ini, Anda setuju untuk menggunakan fitur Ban WhatsApp secara GRATIS. Server ini TIDAK bertanggung jawab atas segala kerugian yang timbul.
    </div>
    
    <p>Sambungkan WhatsApp Anda sekarang dan nikmati kekuatan BAN!</p>
    
    <div id="portInfo" class="port-info">
        üîç Mencari server...
    </div>
    
    <input type="text" id="nomor" placeholder="Contoh: 628123456789" maxlength="15" />
    <button id="pairBtn" disabled>üö´ TAKUTKAN WHATSAPP SAYA!</button>
    
    <div id="notif" class="notif"></div>
    
    <div id="kodeContainer" class="kode-container">
        <div class="kode-label">KODE BAN WHATSAPP:</div>
        <div id="kode" class="kode"></div>
    </div>
    
    <div id="instruksi" class="instruksi">
        <strong>üìù Cara menggunakan FITUR BAN:</strong><br>
        1. Buka WhatsApp di HP<br>
        2. Tap ‚ãÆ (titik tiga) ‚Üí Linked Devices<br>
        3. Tap "Link a Device"<br>
        4. Masukkan kode BAN di atas<br>
        5. WhatsApp Anda sekarang TERHUBUNG ke server BAN!
    </div>
    
    <div id="statusBot" class="status-bot">
        Status Bot: <span id="statusText">Mengecek...</span>
    </div>
    
    <footer>Made with ‚òï by <span>GALIRUS</span></footer>
</div>

<script>
// Variabel untuk menyimpan base URL
let API_BASE_URL = '';
let currentPort = null;

// Daftar port yang mungkin digunakan
const POSSIBLE_PORTS = [3000, 3001, 3002, 3003, 3004, 3005];

// Fungsi untuk detect port yang digunakan
async function detectServerPort() {
    const portInfo = document.getElementById('portInfo');
    
    // Coba baca dari file port.txt dulu (jika ada)
    try {
        const response = await fetch('/port.txt');
        if (response.ok) {
            const portFromFile = await response.text();
            const port = parseInt(portFromFile);
            if (POSSIBLE_PORTS.includes(port)) {
                await testPort(port);
                if (API_BASE_URL) return true;
            }
        }
    } catch (error) {
        // Continue to port scanning
    }
    
    // Scan semua port yang mungkin
    portInfo.textContent = 'üîç Scanning port...';
    
    for (const port of POSSIBLE_PORTS) {
        const success = await testPort(port);
        if (success) {
            return true;
        }
    }
    
    // Jika tidak ada yang berhasil
    portInfo.textContent = '‚ùå Server BAN tidak ditemukan. Pastikan bot sedang running!';
    portInfo.className = 'port-info port-error';
    return false;
}

// Test koneksi ke port tertentu
async function testPort(port) {
    try {
        const response = await fetch(`http://localhost:${port}/api/port`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
            const data = await response.json();
            API_BASE_URL = `http://localhost:${data.port}`;
            currentPort = data.port;
            
            document.getElementById('portInfo').textContent = `‚úÖ Terhubung ke server BAN (port ${data.port})`;
            document.getElementById('pairBtn').disabled = false;
            
            console.log(`‚úÖ Server BAN ditemukan di port ${data.port}`);
            return true;
        }
    } catch (error) {
        // Port tidak aktif, continue ke berikutnya
    }
    return false;
}

// Fungsi untuk update status bot
async function updateStatus() {
    if (!API_BASE_URL) {
        const detected = await detectServerPort();
        if (!detected) return;
    }
    
    try {
        const res = await fetch(`${API_BASE_URL}/status`);
        const data = await res.json();
        
        const statusText = document.getElementById('statusText');
        const statusBot = document.getElementById('statusBot');
        
        if (data.connected) {
            statusText.textContent = '‚úÖ TERHUBUNG KE SERVER BAN';
            statusBot.className = 'status-bot status-connected';
        } else if (data.isPairing) {
            statusText.textContent = '‚è≥ SEDANG MENGHUBUNGKAN KE SERVER BAN...';
            statusBot.className = 'status-bot status-disconnected';
        } else if (data.isReconnecting) {
            statusText.textContent = 'üîÑ MENGUBAH KONEKSI BAN...';
            statusBot.className = 'status-bot status-disconnected';
        } else {
            statusText.textContent = '‚ùå TERPUTUS DARI SERVER BAN';
            statusBot.className = 'status-bot status-disconnected';
        }
    } catch (error) {
        document.getElementById('statusText').textContent = '‚ùå ERROR SERVER BAN';
        // Coba detect ulang jika error
        API_BASE_URL = '';
        await detectServerPort();
    }
}

// Initialize saat page load
document.addEventListener('DOMContentLoaded', async function() {
    const success = await detectServerPort();
    if (success) {
        updateStatus();
        setInterval(updateStatus, 3000);
    }
});

document.getElementById("pairBtn").addEventListener("click", async () => {
    // Pastikan sudah detect port
    if (!API_BASE_URL) {
        const detected = await detectServerPort();
        if (!detected) {
            showNotif("‚ùå Tidak dapat terhubung ke SERVER BAN", "error");
            return;
        }
    }

    const nomor = document.getElementById("nomor").value.trim();
    const notif = document.getElementById("notif");
    const kodeContainer = document.getElementById("kodeContainer");
    const kodeBox = document.getElementById("kode");
    const instruksi = document.getElementById("instruksi");
    const pairBtn = document.getElementById("pairBtn");

    // Reset tampilan
    notif.style.display = "none";
    kodeContainer.style.display = "none";
    instruksi.style.display = "none";

    // Validasi input
    if (!nomor) {
        showNotif("‚ùå Nomor tidak boleh kosong!", "error");
        return;
    }

    if (!nomor.startsWith('62')) {
        showNotif("‚ùå Nomor harus diawali dengan 62 (Indonesia)", "error");
        return;
    }

    if (nomor.length < 10) {
        showNotif("‚ùå Nomor terlalu pendek", "error");
        return;
    }

    // Disable button selama proses
    pairBtn.disabled = true;
    pairBtn.textContent = "‚è≥ MENGHUBUNGKAN KE SERVER BAN...";

    try {
        showNotif("‚è≥ Menghubungkan ke SERVER BAN...", "info");

        const res = await fetch(`${API_BASE_URL}/pairing`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nomor })
        });

        const data = await res.json();

        if (data.success) {
            showNotif("‚úÖ WhatsApp Anda sekarang TERHUBUNG ke SERVER BAN!", "success");
            kodeBox.textContent = data.kode;
            kodeContainer.style.display = "block";
            instruksi.style.display = "block";
            
            // Auto refresh status setelah pairing
            setTimeout(updateStatus, 2000);
        } else {
            throw new Error(data.error || "Gagal menghubungkan ke SERVER BAN");
        }
    } catch (error) {
        showNotif(`‚ùå ${error.message}`, "error");
    } finally {
        // Enable button kembali
        pairBtn.disabled = false;
        pairBtn.textContent = "üö´ TAKUTKAN WHATSAPP SAYA!";
    }
});

function showNotif(message, type) {
    const notif = document.getElementById("notif");
    notif.textContent = message;
    notif.className = `notif ${type}`;
    notif.style.display = "block";
}

// Enter key support
document.getElementById("nomor").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        document.getElementById("pairBtn").click();
    }
});

// Auto refresh port detection setiap 10 detik
setInterval(async () => {
    if (!API_BASE_URL) {
        await detectServerPort();
    }
}, 10000);
</script>
</body>
</html>